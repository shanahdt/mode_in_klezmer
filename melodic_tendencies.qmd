---
title: Melodic Tendencies
---

## Pitch-to-pitch transitions



## Major

```{r, echo=F, warnings=FALSE, message=FALSE}
library(humdrumR)
library(tidyverse)
library(DT)


freygish <- readHumdrum('corpus/extracts/freygish/*.krn')
major <- readHumdrum('corpus/extracts/major/*.krn')
minor <- readHumdrum('corpus/extracts/minor/*.krn')
raised_four <- readHumdrum('corpus/extracts/raised_four/*.krn')
bigram_table <- function(mode){
  x <- mode |> 
      humdrumR::pitch(simple = FALSE) 

  x <- as.data.frame(x, dataTypes = "Dd", padPaths = "corpus", padder = NA)
  y <- as_tibble(x$V1) |> filter(value != ".")

  y <- y |> mutate(second = lead(value, n =1)) |> 
    unite('bigram', value:second, remove = FALSE) 
  
  
  y |> dplyr::count(bigram) |>
    arrange(desc(n)) |> datatable(filter="top", rownames=FALSE)
  
  
  
}

bigram_table(major)
```

And here we see a barplot of the top ten bigrams in major.

```{r, echo=F, warnings=FALSE, message=FALSE}
bigram_bar <- function(mode){
  x <- mode |> 
      humdrumR::pitch(simple = FALSE) 

  x <- as.data.frame(x, dataTypes = "Dd", padPaths = "corpus", padder = NA)
  y <- as_tibble(x$V1) |> filter(value != ".")

  y <- y |> mutate(second = lead(value, n =1)) |> 
    unite('bigram', value:second, remove = FALSE) 
  
  
  bigram_counts <- y |> dplyr::count(bigram) |>
    arrange(desc(n)) 
  
  bigram_top_ten <- bigram_counts |> head(10)
  
  ggplot(data = bigram_top_ten, aes(x = reorder(bigram, -n), y = n, fill = bigram)) +
  geom_bar(stat = "identity") +
  labs(title="Top Ten Bigrams",
        x ="Bigram", y = "Frequency") + theme_bw()
  
}

bigram_bar(major)

```

We can also explore these transitions through a transition matrix. Here we have the top thirty transitions, with the first note being on the y-axis, and the note that it's going to on the x-axis.

```{r, echo=F, warnings=FALSE, message=FALSE}

transition_matrix <- function(mode){
  x <- mode |> 
      humdrumR::pitch(simple = FALSE) 

  x <- as.data.frame(x, dataTypes = "Dd", padPaths = "corpus", padder = NA)
  y <- as_tibble(x$V1) |> filter(value != ".")

  y <- y |> mutate(second = lead(value, n =1)) |> 
    unite('bigram', value:second, remove = FALSE) 
  
  
bigram_counts <- y |> dplyr::count(bigram) |>
    arrange(desc(n)) 
bigram_top_thirty <- bigram_counts %>%
  head(30) %>%
  separate(bigram, into = c('first','second'), sep = '_')

ggplot(data = bigram_top_thirty, mapping = aes(x = second, y = first, fill = n)) +
  geom_tile() +
  labs(title="Top Thirty Bigrams",
        x ="Second Note", y = "First Note") + theme_bw()
}
transition_matrix(major)
        
```
## Minor
```{r, echo=F, warnings=FALSE, message=FALSE}

bigram_table(minor)
```

Here we see a barplot of the top ten bigrams in minor.

```{r, echo=F, warnings=FALSE, message=FALSE}

bigram_bar(minor)
```

```{r, echo=F, warnings=FALSE, message=FALSE}

transition_matrix(minor)
```


## Freygish

```{r, echo=F, warnings=FALSE, message=FALSE}

bigram_table(freygish)
```


And here is a barplot of the top ten bigrams in freygish.
```{r, echo=F, warnings=FALSE, message=FALSE}

bigram_bar(freygish)
```



```{r, echo=F, warnings=FALSE, message=FALSE}

transition_matrix(freygish)
```
## Raised Four

```{r, echo=F, warnings=FALSE, message=FALSE}

bigram_table(raised_four)
```


And here we see a barplot of the top ten bigrams in major.

```{r, echo=F, warnings=FALSE, message=FALSE}

bigram_bar(raised_four)
```

```{r, echo=F, warnings=FALSE, message=FALSE}

transition_matrix(raised_four)
```



